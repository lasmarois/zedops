name = "zedops"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Static Assets (Frontend build output)
# Assets are served first; run_worker_first routes API/WS to Worker code.
# SPA fallback serves dist/index.html for all non-asset navigation requests.
[assets]
directory = "../frontend/dist"
not_found_handling = "single-page-application"
run_worker_first = ["/api/*", "/ws", "/health"]

# Durable Objects (WebSocket hub for agent connections)
[[durable_objects.bindings]]
name = "AGENT_CONNECTION"
class_name = "AgentConnection"

# Durable Objects migrations
# For free plan, use new_sqlite_classes instead of new_classes
[[migrations]]
tag = "v1"
new_sqlite_classes = ["AgentConnection"]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "zedops-db"
database_id = "0c225574-390c-4c51-ba42-8629c7b01f35"

# =============================================================================
# DEVELOPMENT ENVIRONMENT
# =============================================================================
# Deploy with: wrangler deploy --env dev

[env.dev]
name = "zedops-dev"

[[env.dev.durable_objects.bindings]]
name = "AGENT_CONNECTION"
class_name = "AgentConnection"

[[env.dev.migrations]]
tag = "v1"
new_sqlite_classes = ["AgentConnection"]

[[env.dev.d1_databases]]
binding = "DB"
database_name = "zedops-db-dev"
database_id = "7444ea9c-07b2-4967-8526-f0cb1f51cf82"

# =============================================================================
# SECRETS
# =============================================================================
# Production: wrangler secret put TOKEN_SECRET / ADMIN_PASSWORD
# Dev: wrangler secret put TOKEN_SECRET --env dev / ADMIN_PASSWORD --env dev
# Local: Use .dev.vars file
